import{a as g}from"./chunk-SS6XNNEI.js";import{a as l,b as f,c as m,d as U,f as d,g as y,j as s,k as $,m as F}from"./chunk-KKRSEMEC.js";import{$ as c,R as u,W as b,f as n,m as h,t as p,u as a,y as v}from"./chunk-ZOQ26LPS.js";var w=class o{constructor(e,r){this.firestore=e;this.authService=r}role$=new h(null);setUserRole(e,r,t){return n(this,null,function*(){let i=s(this.firestore,`users/${r}`);yield F(i,{role:e,uid:r,name:t},{merge:!0}),this.role$.next(e)})}getUserRole$(){return this.role$.pipe(u(e=>e?a(e):p(this.loadUserRole())))}getAllUsersWithRole(e){let r=l(this.firestore,"users"),t=f(r,m("role","==",e));return d(t,{idField:"uid"})}getAllUsers(e){let r=l(this.firestore,"users"),t=e?f(r,m("role","==",e)):r;return d(t,{idField:"uid"})}getLoggedUserData(){return this.authService.currentUser.pipe(u(e=>{if(!e)return a(null);let r=s(this.firestore,`users/${e.uid}`);return y(r,{idField:"uid"})}))}resetRole(){this.role$.next(null)}loadUserRole(){return n(this,null,function*(){let e=yield v(this.authService.currentUser);if(!e)return"user";let r=s(this.firestore,`users/${e.uid}`),i=(yield $(r)).data()?.role??"user";return this.role$.next(i),i})}static \u0275fac=function(r){return new(r||o)(c(U),c(g))};static \u0275prov=b({token:o,factory:o.\u0275fac,providedIn:"root"})};export{w as a};
